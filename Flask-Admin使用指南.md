# Flask-Admin 使用指南

## 一、访问 Flask-Admin 后台

### 1. 启动应用

```bash
python run.py
```

### 2. 访问后台管理界面

在浏览器中打开：`http://localhost:5000/admin`

### 3. 登录

- **用户名**: `admin`
- **密码**: `admin123`（如果还没有创建，运行 `create_sample_data.py` 或 `create_real_data.py` 会自动创建）

**重要**: 只有用户名为 `admin` 的用户才能访问后台管理界面！

## 二、后台管理界面功能

### 1. 主界面

登录后会看到：
- **用户** - 管理所有用户
- **作物** - 管理所有作物
- **菜品** - 管理所有菜品

### 2. 作物管理（Crop）

#### 查看作物列表
- 点击左侧菜单的 **"作物"**
- 可以看到所有作物的列表
- 显示：ID、名称、恢复饱食度、创建时间

#### 添加新作物
1. 点击右上角的 **"创建"** 按钮
2. 填写表单：
   - **名称** (必填): 作物名称，如 "Cabbage"
   - **描述**: 作物的详细描述
   - **图片URL**: 图片链接（可选）
   - **恢复饱食度**: 数字，如 1, 2, 3
3. 点击 **"保存"** 按钮

#### 编辑作物
1. 在作物列表中，点击要编辑的作物名称或 ID
2. 修改信息
3. 点击 **"保存"** 按钮

#### 删除作物
1. 在作物列表中，勾选要删除的作物（可以多选）
2. 点击列表上方的 **"删除选中项"** 按钮
3. 确认删除

#### 搜索和筛选
- **搜索框**: 可以按名称或描述搜索
- **筛选器**: 可以按恢复饱食度、创建时间筛选

### 3. 菜品管理（Meal）

#### 查看菜品列表
- 点击左侧菜单的 **"菜品"**
- 可以看到所有菜品的列表
- 显示：ID、名称、恢复饱食度、饱和度、创建时间

#### 添加新菜品
1. 点击右上角的 **"创建"** 按钮
2. 填写表单：
   - **名称** (必填): 菜品名称，如 "Apple Pie"
   - **描述**: 菜品的详细描述
   - **图片URL**: 图片链接（可选）
   - **恢复饱食度**: 数字，如 8, 10, 12
   - **饱和度**: 浮点数，如 6.0, 8.0
   - **所需食材**: 多选框，可以选择多个作物作为食材
3. 点击 **"保存"** 按钮

#### 编辑菜品
1. 在菜品列表中，点击要编辑的菜品名称或 ID
2. 修改信息
3. 可以添加或删除食材（在"所需食材"多选框中选择）
4. 点击 **"保存"** 按钮

#### 删除菜品
1. 在菜品列表中，勾选要删除的菜品（可以多选）
2. 点击列表上方的 **"删除选中项"** 按钮
3. 确认删除

### 4. 用户管理（User）

#### 查看用户列表
- 点击左侧菜单的 **"用户"**
- 可以看到所有用户的列表
- 显示：ID、用户名、邮箱、创建时间

#### 编辑用户
1. 点击用户名称或 ID
2. 可以修改用户名和邮箱
3. 如果要修改密码，在"密码"字段输入新密码（留空则不修改）
4. 点击 **"保存"** 按钮

**注意**: 不能通过后台创建新用户，需要通过注册页面注册。

## 三、快速清理数据

### 方法 1: 使用清理脚本（推荐）

```bash
python clear_database.py
```

选择选项：
- **选项 1**: 清空所有数据（保留 admin 用户）
- **选项 2**: 只删除测试数据（保留真实数据）

### 方法 2: 通过 Flask-Admin 手动删除

1. 登录后台：`http://localhost:5000/admin`
2. 进入 **"作物"** 或 **"菜品"** 页面
3. 勾选要删除的项目
4. 点击 **"删除选中项"**

### 方法 3: 完全重置数据库

```bash
# 删除数据库文件
del app.db  # Windows
# 或
rm app.db   # Linux/Mac

# 重新创建数据库
flask db upgrade

# 重新填充数据
python create_real_data.py
```

## 四、常见操作示例

### 示例 1: 删除所有测试数据

```bash
python clear_database.py
# 选择选项 2
```

### 示例 2: 清空数据库并重新填充

```bash
# 1. 清空数据库
python clear_database.py
# 选择选项 1

# 2. 填充真实数据
python create_real_data.py
```

### 示例 3: 通过后台添加新作物

1. 访问 `http://localhost:5000/admin`
2. 登录（admin / admin123）
3. 点击 **"作物"** → **"创建"**
4. 填写：
   - 名称: "Rice"
   - 描述: "A grain crop..."
   - 恢复饱食度: 1
5. 点击 **"保存"**

### 示例 4: 通过后台编辑菜品并添加食材

1. 访问后台，点击 **"菜品"**
2. 点击要编辑的菜品（如 "Fried Rice"）
3. 在 **"所需食材"** 多选框中：
   - 勾选 "Rice"
   - 勾选 "Onion"
   - 勾选 "Carrot"
4. 点击 **"保存"**

## 五、注意事项

1. **权限**: 只有 `admin` 用户才能访问后台
2. **数据安全**: 删除操作不可恢复，请谨慎操作
3. **关联关系**: 删除作物或菜品时，会自动删除相关的关联关系
4. **唯一性**: 作物和菜品的名称必须唯一
5. **必填字段**: 名称、恢复饱食度等字段是必填的

## 六、故障排除

### 问题 1: 无法访问后台（403 Forbidden）

**原因**: 当前登录用户不是 `admin`

**解决**:
1. 确保已创建 admin 用户（运行 `create_sample_data.py` 或 `create_real_data.py`）
2. 使用 admin 账号登录（username: admin, password: admin123）

### 问题 2: 无法删除数据

**原因**: 可能有外键约束

**解决**: 使用清理脚本 `clear_database.py`，它会正确处理关联关系

### 问题 3: 保存时出错

**原因**: 可能是数据验证失败（如名称重复、必填字段为空）

**解决**: 检查错误提示，确保：
- 名称唯一
- 必填字段已填写
- 数字字段格式正确

## 七、推荐工作流程

### 清理并重新填充数据

```bash
# 1. 清空所有数据
python clear_database.py
# 选择 1

# 2. 填充真实数据
python create_real_data.py

# 3. 启动应用
python run.py

# 4. 访问后台查看/编辑
# http://localhost:5000/admin
```

### 只删除测试数据

```bash
# 1. 删除测试数据
python clear_database.py
# 选择 2

# 2. 如果需要，补充真实数据
python create_real_data.py
```

