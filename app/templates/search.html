{% extends "base.html" %}

{% block title %}搜索 - Farmer's Delight Wiki{% endblock %}

{% block content %}
<article>
    <header>
        <h1>搜索</h1>
    </header>

    <form method="POST" action="{{ url_for('main.search') }}" class="search-form" role="search">
        {{ form.hidden_tag() }}
        
        <div class="form-group">
            {{ form.keyword.label }}
            {{ form.keyword(class="form-control", aria_label="搜索关键词", aria_describedby="keyword-help") }}
            <small id="keyword-help" class="form-text">输入作物或菜品的名称或描述</small>
            {% if form.keyword.errors %}
                <div class="error-message" role="alert">
                    {% for error in form.keyword.errors %}
                        <span>{{ error }}</span>
                    {% endfor %}
                </div>
            {% endif %}
        </div>

        <div class="form-group">
            {{ form.search_type.label }}
            <div class="radio-group" role="radiogroup" aria-label="搜索类型">
                {% for subfield in form.search_type %}
                    <label>
                        {{ subfield }}
                        {{ subfield.label.text }}
                    </label>
                {% endfor %}
            </div>
        </div>

        <div class="form-group">
            {{ form.sort_by.label }}
            {{ form.sort_by(class="form-control", aria_label="排序方式") }}
        </div>

        <div class="form-group">
            {{ form.submit(class="btn btn-primary") }}
        </div>
    </form>

    {% if results is defined %}
        <section class="search-results">
            <h2>搜索结果</h2>
            {% if results %}
                <div class="results-grid">
                    {% for item in results %}
                        {% if item.__class__.__name__ == 'Crop' %}
                            <article class="crop-card">
                                {% if item.image_url %}
                                    <img src="{{ item.image_url }}" alt="{{ item.name }}" loading="lazy">
                                {% else %}
                                    <div class="placeholder-image">无图片</div>
                                {% endif %}
                                <h3><a href="{{ url_for('main.crop_detail', id=item.id) }}">{{ item.name }}</a></h3>
                                <p class="crop-stats">恢复饱食度: {{ item.hunger_points }}</p>
                            </article>
                        {% else %}
                            <article class="meal-card">
                                {% if item.image_url %}
                                    <img src="{{ item.image_url }}" alt="{{ item.name }}" loading="lazy">
                                {% else %}
                                    <div class="placeholder-image">无图片</div>
                                {% endif %}
                                <h3><a href="{{ url_for('main.meal_detail', id=item.id) }}">{{ item.name }}</a></h3>
                                <p class="meal-stats">恢复饱食度: {{ item.hunger_restored }}</p>
                            </article>
                        {% endif %}
                    {% endfor %}
                </div>
            {% else %}
                <div class="no-results" role="alert">
                    <p>未找到相关结果。请尝试其他关键词。</p>
                </div>
            {% endif %}
        </section>
    {% endif %}
</article>
{% endblock %}

