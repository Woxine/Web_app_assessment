{% extends "base.html" %}

{% block title %}Search - Farmer's Delight Wiki{% endblock %}

{% block content %}
<section>
    <header>
        <h1>üîç Search</h1>
        <p>Find the crops or meals you want in the world of Farmer's Delight!</p>
    </header>

    <form method="POST" action="{{ url_for('main.search') }}" class="search-form" role="search">
        {{ form.hidden_tag() }}

        <div class="form-group">
            {{ form.keyword.label }}
            {{ form.keyword(class="form-control", placeholder="Enter the name of a crop or meal", aria_label="Search keyword", aria_describedby="keyword-help") }}
            <small id="keyword-help" class="form-text">üí° Enter the name or description of a crop or meal</small>
            {% if form.keyword.errors %}
                <div class="error-message" role="alert">
                    {% for error in form.keyword.errors %}
                        <span>{{ error }}</span>
                    {% endfor %}
                </div>
            {% endif %}
        </div>

        <div class="form-group">
            {{ form.search_type.label }}
            <div class="radio-group" role="radiogroup" aria-label="Search type">
                {% for subfield in form.search_type %}
                    <label>
                        {{ subfield }}
                        {{ subfield.label.text }}
                    </label>
                {% endfor %}
            </div>
        </div>

        <div class="form-group">
            {{ form.sort_by.label }}
            {{ form.sort_by(class="form-control", aria_label="Sort by") }}
        </div>

        <div class="form-group">
            {{ form.submit(class="btn btn-primary") }}
        </div>
    </form>

    {% if results is defined %}
        <section class="search-results">
            <h2>üìã Search Results</h2>
            {% if results %}
                <div class="results-grid">
                    {% for item in results %}
                        {% if item.__class__.__name__ == 'Crop' %}
                            <article class="crop-card">
                                {% if item.image_url %}
                                    <img src="{{ item.image_url }}" alt="{{ item.name }}" loading="lazy">
                                {% else %}
                                    <div class="placeholder-image">
                                        <span>üåø</span>
                                        <p>No image available</p>
                                    </div>
                                {% endif %}
                                <h3><a href="{{ url_for('main.crop_detail', id=item.id) }}">{{ item.name }}</a></h3>
                                <p class="crop-stats">üçé Hunger Restored: {{ item.hunger_points }}</p>
                            </article>
                        {% else %}
                            <article class="meal-card">
                                {% if item.image_url %}
                                    <img src="{{ item.image_url }}" alt="{{ item.name }}" loading="lazy">
                                {% else %}
                                    <div class="placeholder-image">
                                        <span>üçΩÔ∏è</span>
                                        <p>No image available</p>
                                    </div>
                                {% endif %}
                                <h3><a href="{{ url_for('main.meal_detail', id=item.id) }}">{{ item.name }}</a></h3>
                                <p class="meal-stats">üçé Hunger Restored: {{ item.hunger_restored }}</p>
                            </article>
                        {% endif %}
                    {% endfor %}
                </div>
            {% else %}
                <div class="no-results" role="alert">
                    <h3>üîç No relevant results found</h3>
                    <p>Please try other keywords or check spelling.</p>
                </div>
            {% endif %}
        </section>
    {% endif %}
</section>
{% endblock %}

